<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Media Cloud Uploader</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      min-height: 100vh;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #74ebd5, #acb6e5);
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .container {
      background-color: #ffffff;
      border-radius: 20px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
      width: 90%;
      max-width: 700px;
      padding: 30px;
      margin: 20px;
      animation: fadeIn 0.5s ease-in-out;
    }

    @keyframes fadeIn {
      from {
        transform: translateY(20px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    h2 {
      text-align: center;
      color: #333;
      margin-bottom: 20px;
    }

    input[type="file"] {
      display: block;
      margin: 20px auto;
      width: 100%;
    }

    button {
      background: #ff6b6b;
      border: none;
      padding: 12px 20px;
      color: white;
      font-weight: bold;
      border-radius: 8px;
      cursor: pointer;
      margin: 10px 5px 0 0;
      transition: all 0.3s ease;
    }

    button:hover {
      background: #ff4757;
    }

    button:disabled {
      background: #cccccc;
      cursor: not-allowed;
    }

    #preview, #imagePreview {
      width: 100%;
      max-height: 320px;
      object-fit: contain;
      border: 3px dashed #ccc;
      border-radius: 10px;
      margin-top: 15px;
      display: none;
    }

    #preview {
      background: #000;
    }

    #url,
    .gallery-url {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      border: 2px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
    }

    #result {
      margin-top: 30px;
      display: none;
    }

    #gallery {
      margin-top: 30px;
      display: none;
    }

    .gallery-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .gallery-item {
      background: #fefefe;
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.07);
      text-align: center;
      transition: transform 0.3s ease;
      position: relative;
    }

    .gallery-item:hover {
      transform: translateY(-5px);
    }

    .gallery-item img, .gallery-item video {
      max-width: 100%;
      max-height: 140px;
      object-fit: cover;
      border-radius: 8px;
      margin-bottom: 10px;
    }

    .gallery-item video {
      background: #000;
    }

    .gallery-item button {
      background: #1dd1a1;
      width: 100%;
    }

    .gallery-item button:hover {
      background: #10ac84;
    }

    .media-type-badge {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 3px 6px;
      border-radius: 4px;
      font-size: 12px;
    }

    .empty-msg {
      text-align: center;
      color: #555;
    }

    .status-message {
      margin: 10px 0;
      padding: 10px;
      border-radius: 5px;
      text-align: center;
    }

    .error {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .success {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .info {
      background-color: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }

    .progress-container {
      width: 100%;
      background-color: #f1f1f1;
      border-radius: 5px;
      margin: 15px 0;
      display: none;
    }

    .progress-bar {
      height: 20px;
      background-color: #4CAF50;
      border-radius: 5px;
      width: 0%;
      transition: width 0.3s;
    }

    @media (max-width: 768px) {
      button {
        width: 100%;
        margin: 10px 0;
      }

      .gallery-grid {
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      }
    }

    @media (max-width: 480px) {
      .container {
        padding: 20px;
      }

      h2 {
        font-size: 1.5rem;
      }

      .gallery-item img, .gallery-item video {
        max-height: 120px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>üåà Media Cloud Uploader</h2>

    <input type="file" id="upload" accept="image/*,video/*" />
    <div id="statusMessage" class="status-message"></div>
    <div class="progress-container" id="progressContainer">
      <div class="progress-bar" id="progressBar"></div>
    </div>
    
    <div style="text-align: center;">
      <button id="uploadBtn">üöÄ Upload to Cloud</button>
      <button id="showGalleryBtn">üñºÔ∏è View Gallery</button>
      <button id="clearGalleryBtn" style="background: #ff9f43;">üßπ Clear Gallery</button>
    </div>

    <div id="result">
      <h3>‚úÖ Uploaded Media:</h3>
      <video id="preview" controls></video>
      <img id="imagePreview" alt="Image Preview">
      <input type="text" id="url" readonly />
      <button id="copyBtn">üìã Copy URL</button>
    </div>

    <div id="gallery">
      <h3>üßæ Your Uploaded Gallery</h3>
      <div id="gallery-items" class="gallery-grid"></div>
    </div>
  </div>

  <script>
    // Configuration
    const API_KEY = "ed912d30c774fff0fd4bf124839e1a48";
    const MAX_FILE_SIZE = 32 * 1024 * 1024; // 32MB
    const SUPPORTED_TYPES = [
      'image/jpeg', 'image/png', 'image/gif', 'image/webp',
      'video/mp4', 'video/webm', 'video/ogg'
    ];

    // DOM Elements
    const elements = {
      uploadBtn: document.getElementById("uploadBtn"),
      showGalleryBtn: document.getElementById("showGalleryBtn"),
      clearGalleryBtn: document.getElementById("clearGalleryBtn"),
      uploadInput: document.getElementById("upload"),
      statusMessage: document.getElementById("statusMessage"),
      progressContainer: document.getElementById("progressContainer"),
      progressBar: document.getElementById("progressBar"),
      previewVideo: document.getElementById("preview"),
      previewImage: document.getElementById("imagePreview"),
      resultDiv: document.getElementById("result"),
      galleryDiv: document.getElementById("gallery"),
      urlInput: document.getElementById("url"),
      copyBtn: document.getElementById("copyBtn"),
      galleryItems: document.getElementById("gallery-items")
    };

    // State
    let uploadedMediaUrls = JSON.parse(localStorage.getItem("imgbbUrls") || "[]");

    // Helper Functions
    function showStatus(message, type = 'info') {
      elements.statusMessage.textContent = message;
      elements.statusMessage.className = `status-message ${type}`;
    }

    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    function resetUploadUI() {
      elements.uploadBtn.disabled = false;
      elements.uploadBtn.textContent = "üöÄ Upload to Cloud";
      elements.progressContainer.style.display = "none";
      elements.progressBar.style.width = "0%";
    }

    // Event Listeners
    elements.uploadInput.addEventListener("change", function() {
      const file = this.files[0];
      if (!file) return;

      // Validate file
      if (!SUPPORTED_TYPES.includes(file.type)) {
        showStatus(`‚ùå Unsupported file type: ${file.type}`, 'error');
        this.value = "";
        elements.uploadBtn.disabled = true;
        return;
      }

      if (file.size > MAX_FILE_SIZE) {
        showStatus(`‚ùå File too large: ${formatFileSize(file.size)} (max ${formatFileSize(MAX_FILE_SIZE)})`, 'error');
        this.value = "";
        elements.uploadBtn.disabled = true;
        return;
      }

      showStatus(`‚úîÔ∏è Ready to upload: ${file.name} (${formatFileSize(file.size)})`, 'info');
      elements.uploadBtn.disabled = false;
    });

    elements.uploadBtn.addEventListener("click", async function() {
      const file = elements.uploadInput.files[0];
      if (!file) {
        showStatus("üö´ Please select a file first!", 'error');
        return;
      }

      try {
        // Show preview
        elements.previewVideo.style.display = "none";
        elements.previewImage.style.display = "none";

        if (file.type.startsWith("video/")) {
          elements.previewVideo.src = URL.createObjectURL(file);
          elements.previewVideo.style.display = "block";
        } else {
          elements.previewImage.src = URL.createObjectURL(file);
          elements.previewImage.style.display = "block";
        }

        // Prepare upload
        const formData = new FormData();
        formData.append("image", file);

        // Show loading state
        elements.uploadBtn.disabled = true;
        elements.uploadBtn.textContent = "‚è≥ Uploading...";
        elements.progressContainer.style.display = "block";
        showStatus("Uploading your file...", 'info');

        // Create progress event
        const xhr = new XMLHttpRequest();
        xhr.upload.addEventListener("progress", function(e) {
          if (e.lengthComputable) {
            const percentComplete = (e.loaded / e.total) * 100;
            elements.progressBar.style.width = percentComplete + "%";
          }
        });

        // Send request
        const response = await fetch(`https://api.imgbb.com/1/upload?key=${API_KEY}`, {
          method: "POST",
          body: formData
        });

        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.error?.message || "Upload failed with status: " + response.status);
        }

        const data = await response.json();
        if (!data.success) {
          throw new Error(data.error?.message || "Upload failed unexpectedly");
        }

        // Handle success
        const mediaUrl = data.data.url;
        uploadedMediaUrls.push({
          url: mediaUrl,
          type: file.type.startsWith("video/") ? "video" : "image",
          name: file.name,
          size: file.size,
          uploadedAt: new Date().toISOString()
        });
        localStorage.setItem("imgbbUrls", JSON.stringify(uploadedMediaUrls));

        elements.urlInput.value = mediaUrl;
        elements.resultDiv.style.display = "block";
        elements.galleryDiv.style.display = "none";
        
        showStatus("‚úÖ Upload successful!", 'success');
        elements.uploadInput.value = "";

      } catch (error) {
        console.error("Upload error:", error);
        showStatus(`‚ùå Error: ${error.message}`, 'error');
      } finally {
        resetUploadUI();
      }
    });

    elements.showGalleryBtn.addEventListener("click", renderGallery);
    elements.clearGalleryBtn.addEventListener("click", clearGallery);
    elements.copyBtn.addEventListener("click", copyUrl);

    // Gallery Functions
    function renderGallery() {
      elements.resultDiv.style.display = "none";
      elements.galleryDiv.style.display = "block";
      elements.galleryItems.innerHTML = "";

      if (uploadedMediaUrls.length === 0) {
        elements.galleryItems.innerHTML = '<p class="empty-msg">üì≠ No media uploaded yet</p>';
        return;
      }

      uploadedMediaUrls.forEach((media) => {
        const item = document.createElement("div");
        item.className = "gallery-item";

        const typeBadge = document.createElement("span");
        typeBadge.className = "media-type-badge";
        typeBadge.textContent = media.type === "video" ? "VIDEO" : "IMAGE";
        item.appendChild(typeBadge);

        if (media.type === "video") {
          const video = document.createElement("video");
          video.src = media.url;
          video.controls = true;
          item.appendChild(video);
        } else {
          const img = document.createElement("img");
          img.src = media.url;
          img.alt = media.name;
          item.appendChild(img);
        }

        const nameEl = document.createElement("div");
        nameEl.textContent = media.name;
        nameEl.style.fontSize = "12px";
        nameEl.style.margin = "5px 0";
        nameEl.style.whiteSpace = "nowrap";
        nameEl.style.overflow = "hidden";
        nameEl.style.textOverflow = "ellipsis";
        item.appendChild(nameEl);

        const sizeEl = document.createElement("div");
        sizeEl.textContent = formatFileSize(media.size);
        sizeEl.style.fontSize = "11px";
        sizeEl.style.color = "#666";
        item.appendChild(sizeEl);

        const urlInput = document.createElement("input");
        urlInput.type = "text";
        urlInput.value = media.url;
        urlInput.readOnly = true;
        urlInput.className = "gallery-url";

        const copyBtn = document.createElement("button");
        copyBtn.textContent = "Copy URL";
        copyBtn.addEventListener("click", () => {
          urlInput.select();
          document.execCommand("copy");
          showStatus("‚úÖ URL copied to clipboard!", 'success');
        });

        item.appendChild(urlInput);
        item.appendChild(copyBtn);
        elements.galleryItems.appendChild(item);
      });
    }

    function clearGallery() {
      if (confirm("Are you sure you want to clear all uploaded media?")) {
        uploadedMediaUrls = [];
        localStorage.setItem("imgbbUrls", JSON.stringify(uploadedMediaUrls));
        renderGallery();
        showStatus("Gallery cleared", 'info');
      }
    }

    function copyUrl() {
      elements.urlInput.select();
      document.execCommand("copy");
      showStatus("‚úÖ URL copied to clipboard!", 'success');
    }

    // Initialize
    if (uploadedMediaUrls.length > 0) {
      renderGallery();
    }
  </script>
</body>
</html>